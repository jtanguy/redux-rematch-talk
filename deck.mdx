import { Head, Appear, Image } from 'mdx-deck'
export { components } from "mdx-deck-code-surfer"
export { default as theme } from './theme'

<Head>
  <title>Redux + Rematch</title>
  <meta name="author" title="Julien Tanguy"/>
  <meta name='twitter:site' content='@jutanguy' />
</Head>

# Redux + Rematch

Comment gérer un état qui n'en finit pas de grossir

---

# Gestion de l'état

<ul>
  <Appear>
    <li>user</li>
    <li>language</li>
  </Appear>
</ul>

---

```jsx Prop drilling
import React from 'react'

const Card = ({theme, title, image}) => (
  <div className={`card card--${theme}`}>
    <CardImage image={image}/>
    <CardTitle title={title}/>
  </div>
)

const Panel = ({theme, cards}) => (
  <div className={`panel panel--${theme}`}>
    {cards.map(c => <Card theme={theme} title={c.title} image={c.image}/>)}
  </div>
)

class App extends React.Component {
  static state = {
    theme: 'dark'
  }

  switchTheme = (theme) => this.setState({theme});

  render(){
    const { theme } = this.state;
    const { children } = this.props;
    return (
      <div className="container">
        <Sidebar theme={theme} switchTheme={switchTheme}/>
        <Content theme={theme}>
          {children}
        </Content>
      </div>
    )
  }
}
----
*
3:8
10:14
16:36
*
```

---


Bref rappel du pourquoi redux, en une slide de code avec un state ingérable

* Prop drilling
* composition d'états

---

```jsx \#NoRedux
import React from 'react'

const ThemeContext = React.createContext('dark')

class App extends React.Component {
  render() {
    return (
      <ThemeContext.Provider value="dark">
        <Toolbar />
      </ThemeContext.Provider>
    );
  }
}

function Toolbar(props) {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

class ThemedButton extends React.Component {
  static contextType = ThemeContext;
  render() {
    return <Button theme={this.context} />;
  }
}
----
*
3 > API context
5:13
8,10 > Context.Provider
15:21
18 > Pas de theme ici
23:28
24,26 > contextType (React 16.6)
*
```

---

# Redux === Code applicatif

---

Concepts de base de redux

* (commencer à parler d'évènements/de faits passés)
* actions
* reducers
* store: getState + dispatch
* devtools

3-4 slides

---

<Image src="https://staltz.com/img/redux-unidir-ui-arch.jpg" size="contain"/>

---

Utilisation avec React

* Connect
* container vs components

---

## asynchrone

* redux thunk

* je ne parlerai pas des sagas


---
Instant protip

* redux-api-middleware non, et pourquoi (mélange de commandes et d'events, middleware)

* redux-form non, et pourquoi

--- 

Overdose de verbosité

* trop d'action creators
* et de
* code
* dans pleins de fichiers

--- 

Instant protip

containers vs components => screens et components/ui

---

## redux ducks

https://github.com/erikras/ducks-modular-redux


---

## Tests

jest

--- 

## rematch

https://hackernoon.com/redesigning-redux-b2baee8b8a38

rematch = ducks + thunk 


---

## eventsourcing

* Bien insister sur le concept d'évènement, de fait passé
* parallèle effect/command

---

## Instant protiop

* revenir dans les devtools


---

## Exemple boite de commentaire

mini formulaire: add + edit

* import/export

Historique ?

BOOM! même import



---
# Liens

* <https://redux.js.org>
* Rematch
